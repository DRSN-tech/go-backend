<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="667.9995007009531" height="745.714596186"><desc>%2F%2F%20%D0%A4%D0%BE%D0%BD%D0%BE%D0%B2%D0%B0%D1%8F%20%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0%20%D0%B8%D0%B2%D0%B5%D0%BD%D1%82%D0%BE%D0%B2%20%D0%B4%D0%BB%D1%8F%20%D0%BE%D1%82%D0%BF%D1%80%D0%B0%D0%B2%D0%BA%D0%B8%20%D0%B2%20%D0%BA%D0%B0%D1%84%D0%BA%D1%83%0Aactor%20worker%0Adatabase%20%22PostgreSQL%22%20as%20db%0Arparticipant%20%22Kafka%22%20as%20kafka%0A%0Anote%20right%20of%20worker%3A%20%D0%94%D0%B2%D0%B0%20%D0%BF%D0%BE%D1%82%D0%BE%D0%BA%D0%B0%5Cn%20%20-%20run()%3A%20%D0%BE%D0%B4%D0%BD%D0%BE%D0%BA%D1%80%D0%B0%D1%82%D0%BD%D0%BE%20%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%B0%D1%82%D1%8B%D0%B2%D0%B0%D0%B5%D1%82%5Cn%20%20%20%20%D0%B2%D1%81%D0%B5%20%D0%BD%D0%B0%D0%BA%D0%BE%D0%BF%D0%B8%D0%B2%D1%88%D0%B8%D0%B5%D1%81%D1%8F%20%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D1%8F%20%D0%BF%D1%80%D0%B8%20%D1%81%D1%82%D0%B0%D1%80%D1%82%D0%B5%5Cn%20%20-%20listenOutboxNotifications()%3A%20%D1%81%D0%BB%D1%83%D1%88%D0%B0%D0%B5%D1%82%20NOTIFY%0A%0Agroup%20%D0%A4%D0%BE%D0%BD%D0%BE%D0%B2%D1%8B%D0%B9%20%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%0A%20%20worker%20%3C--%20db%3A%20NOTIFY%20outbox_pending%0A%20%20worker%20-%3E%20db%3A%20%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C%20%D0%B1%D0%B0%D1%82%D1%87%20%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B9%20(%D0%B4%D0%BE%2010)%0A%20%20worker%20%3C--%20db%3A%20%D0%9F%D0%BE%D1%81%D0%BB%D0%B5%D0%B4%D0%BD%D0%B8%D0%B5%20%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D1%8F%20%D0%B8%D0%B7%5Cn(%D1%81%D0%BE%D1%80%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B0%20%D0%BF%D0%BE%20%D0%B4%D0%B0%D1%82%D0%B5%20%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F%2C%20%D0%B4%D0%BE%2010)%0A%20%20loop%20%D0%BF%D0%BE%D0%BA%D0%B0%20%D0%B1%D0%B0%D1%82%D1%87%20%D0%BD%D0%B5%20%D0%BF%D1%83%D1%81%D1%82%0A%20%20%20%20worker%20-%3E%20kafka%3A%20%D0%9E%D1%82%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D1%82%D1%8C%20%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B5%0A%20%20%20%20worker%20-%3E%20db%3A%20%D0%9F%D0%BE%D0%BC%D0%B5%D1%82%D0%B8%D1%82%D1%8C%20%D0%BA%D0%B0%D0%BA%20%D0%BE%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%BD%D0%BD%D0%BE%D0%B5%0A%20%20%20%20worker%20-%3E%20db%3A%20%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C%20%D1%81%D0%BB%D0%B5%D0%B4%D1%83%D1%8E%D1%89%D0%B8%D0%B9%20%D0%B1%D0%B0%D1%82%D1%87%0A%20%20end%0Aend</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="667" height="745"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 96.7546657 94.81957238599999 L 96.7546657 745.714596186" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 475.893886422539 94.81957238599999 L 475.893886422539 745.714596186" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 571.2448350009531 94.81957238599999 L 571.2448350009531 745.714596186" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/></g><g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 106.78196741800001 20.406438583999993 A 10.027301717999999 10.027301717999999 0 1 1 106.78196240434956 20.396411283953203" stroke-miterlimit="10" stroke-width="2.990598758" stroke-dasharray=""/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 96.7546657 30.433740301999993 L 96.7546657 51.895684329999995 M 84.088600372 38.174113557999995 L 109.420731028 38.174113557999995 M 96.7546657 51.895684329999995 L 84.088600372 71.95028776599999 M 96.7546657 51.895684329999995 L 109.420731028 71.95028776599999" stroke-miterlimit="10" stroke-width="2.990598758"/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="74.76112016777344" y="89.542045166" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">worker</text></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 450.20992061853906 21.90173796299999 C 450.20992061853906 6.5757989161199895 501.577852226539 6.5757989161199895 501.577852226539 21.90173796299999 L 501.577852226539 58.84442850299999 C 501.577852226539 74.17036754987998 450.20992061853906 74.17036754987998 450.20992061853906 58.84442850299999 Z" stroke-miterlimit="10" stroke-width="2.990598758" stroke-dasharray=""/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 450.20992061853906 21.90173796299999 C 450.20992061853906 37.22767700988 501.577852226539 37.22767700988 501.577852226539 21.90173796299999" stroke-miterlimit="10" stroke-width="2.990598758"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="435.9654806608203" y="89.54204516599998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">PostgreSQL</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 533.4140495842578 63.330326639999996 L 533.4140495842578 63.330326639999996 A 15.832581659999999 15.832581659999999 0 0 1 549.2466312442577 47.49774497999999 L 593.2430387576485 47.49774497999999 L 593.2430387576485 47.49774497999999 A 15.832581659999999 15.832581659999999 0 0 1 609.0756204176485 63.330326639999996 L 609.0756204176485 78.98699072599999 L 609.0756204176485 78.98699072599999 A 15.832581659999999 15.832581659999999 0 0 1 593.2430387576485 94.81957238599999 L 549.2466312442577 94.81957238599999 L 549.2466312442577 94.81957238599999 A 15.832581659999999 15.832581659999999 0 0 1 533.4140495842578 78.98699072599999 Z" stroke-miterlimit="10" stroke-width="2.990598758" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="552.5011063632578" y="77.227814986" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Kafka</text></g></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 96.7546657 176.621244296 L 105.5505444 176.621244296" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 105.5505444 130.003087186 L 451.265426062539 130.003087186 L 467.098007722539 145.83566884599998 L 467.098007722539 223.23940140599998 L 105.5505444 223.23940140599998 Z" stroke-miterlimit="10" stroke-width="1.4659797833333332"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 451.265426062539 130.003087186 L 451.265426062539 145.83566884599998 L 467.098007722539 145.83566884599998" stroke-miterlimit="10" stroke-width="1.4659797833333332"/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.17900476" y="154.631547546" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Два потока</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.17900476" y="172.223304946" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  - run(): однократно обрабатывает</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.17900476" y="189.81506234600002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    все накопившиеся события при старте</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.17900476" y="207.40681974600002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  - listenOutboxNotifications(): слушает NOTIFY</text></g><g><rect fill="white" stroke="none" x="202.60105505380858" y="297.12478248599996" width="167.44644201492187" height="22.86928462"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="205.2398186638086" y="312.957364146" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">NOTIFY outbox_pending</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 475.893886422539 319.99406710599993 L 111.23854595933334 319.99406710599993" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(96.7546657,319.99406710599993) translate(-96.7546657,-319.99406710599993)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 111.41446353333333 312.6641681893333 L 96.7546657 319.99406710599993 L 111.41446353333333 327.3239660226666 Z"/></g></g><g><rect fill="white" stroke="none" x="176.1014288941406" y="346.38170320599994" width="220.4456943342578" height="22.86928462"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="178.74019250414062" y="362.21428486599996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Получить батч событий (до 10)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 96.7546657 369.2509878259999 L 461.4100061632057 369.2509878259999" stroke-miterlimit="10" stroke-width="1.4659797833333332"/><g transform="translate(475.893886422539,369.2509878259999) translate(-475.893886422539,-369.2509878259999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 461.23408858920567 361.92108890933326 L 475.893886422539 369.2509878259999 L 461.23408858920567 376.58088674266656 Z"/></g></g><g><rect fill="white" stroke="none" x="153.10932531748045" y="395.6386239259999" width="163.981872923125" height="22.86928462"/><rect fill="white" stroke="none" x="153.10932531748045" y="413.23038132599993" width="266.42990148757815" height="22.86928462"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="155.74808892748047" y="411.47120558599994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Последние события из</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="155.74808892748047" y="429.06296298599995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(сортировка по дате создания, до 10)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 475.893886422539 436.0996659459999 L 111.23854595933334 436.0996659459999" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(96.7546657,436.0996659459999) translate(-96.7546657,-436.0996659459999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 111.41446353333333 428.76976702933325 L 96.7546657 436.0996659459999 L 111.41446353333333 443.42956486266655 Z"/></g></g><g><rect fill="white" stroke="none" x="262.97875407446094" y="509.9850470259999" width="142.04199255203125" height="22.86928462"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="265.61751768446095" y="525.8176286859999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Отправить событие</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 96.7546657 532.8543316459999 L 556.7609547416198 532.8543316459999" stroke-miterlimit="10" stroke-width="1.4659797833333332"/><g transform="translate(571.2448350009531,532.8543316459999) translate(-571.2448350009531,-532.8543316459999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 556.5850371676198 525.5244327293332 L 571.2448350009531 532.8543316459999 L 556.5850371676198 540.1842305626666 Z"/></g></g><g><rect fill="white" stroke="none" x="185.39992895517577" y="559.2419677459999" width="201.8486942121875" height="22.86928462"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="188.03869256517578" y="575.0745494059998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Пометить как обработанное</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 96.7546657 582.1112523659999 L 461.4100061632057 582.1112523659999" stroke-miterlimit="10" stroke-width="1.4659797833333332"/><g transform="translate(475.893886422539,582.1112523659999) translate(-475.893886422539,-582.1112523659999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 461.23408858920567 574.7813534493332 L 475.893886422539 582.1112523659999 L 461.23408858920567 589.4411512826666 Z"/></g></g><g><rect fill="white" stroke="none" x="190.93677130136717" y="608.4988884659999" width="190.77500951980468" height="22.86928462"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="193.57553491136719" y="624.3314701259999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Получить следующий батч</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 96.7546657 631.368173086 L 461.4100061632057 631.368173086" stroke-miterlimit="10" stroke-width="1.4659797833333332"/><g transform="translate(475.893886422539,631.368173086) translate(-475.893886422539,-631.368173086)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 461.23408858920567 624.0382741693332 L 475.893886422539 631.368173086 L 461.23408858920567 638.6980720026667 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 17.591757400000006 249.62703750599997 L 650.4077433009531 249.62703750599997 L 650.4077433009531 684.143445286 L 17.591757400000006 684.143445286 L 17.591757400000006 249.62703750599997 Z" stroke-miterlimit="10" stroke-width="2.5131082"/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 17.591757400000006 249.62703750599997 L 17.591757400000006 270.73714638599995 L 159.1642339919922 270.73714638599995 L 169.7192884319922 260.18209194599996 L 169.7192884319922 249.62703750599997 L 17.591757400000006 249.62703750599997" stroke-miterlimit="10" stroke-width="2.5131082"/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="35.183514800000005" y="263.70044342599994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Фоновый процесс</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 35.18351480000001 462.4873020459999 L 632.8159859009531 462.4873020459999 L 632.8159859009531 657.755809186 L 35.18351480000001 657.755809186 L 35.18351480000001 462.4873020459999 Z" stroke-miterlimit="10" stroke-width="2.5131082"/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 35.18351480000001 462.4873020459999 L 35.18351480000001 483.5974109259999 L 95.12142413125001 483.5974109259999 L 105.67647857125002 473.0423564859999 L 105.67647857125002 462.4873020459999 L 35.18351480000001 462.4873020459999" stroke-miterlimit="10" stroke-width="2.5131082"/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="52.77527220000001" y="476.5607079659999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">loop</text><g><rect fill="white" stroke="none" x="120.62947236125002" y="463.8946426379999" width="116.74105871414062" height="18.295427696"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="123.26823597125002" y="476.5607079659999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[пока батч не пуст]</text></g></g><g/></g></svg>